<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>StarChip Scanner</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#04040a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="/icon-192.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&family=Share+Tech+Mono&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #04040a; color: #d8dce6;
    font-family: 'Rajdhani', -apple-system, sans-serif;
    min-height: 100vh; overflow-x: hidden;
  }

  /* ── STARFIELD ── */
  .starfield { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }
  .star { position: absolute; border-radius: 50%; background: #fff; }
  .asteroid { position: absolute; border-radius: 30% 70% 50% 50%; opacity: 0.06; transform: rotate(var(--rot)); }
  @keyframes twinkle { 0%,100%{opacity:var(--base-o)} 50%{opacity:var(--peak-o)} }
  @keyframes drift { 0%{transform:translate(0,0) rotate(var(--rot))} 100%{transform:translate(var(--dx),var(--dy)) rotate(calc(var(--rot)+20deg))} }

  .screen {
    display: none; flex-direction: column; align-items: center;
    padding: 24px; min-height: 100vh; position: relative; z-index: 1;
  }
  .screen.active { display: flex; }

  /* ── JOIN SCREEN ── */
  .logo {
    font-family: 'Orbitron', sans-serif;
    font-size: 26px; font-weight: 900; letter-spacing: 3px; color: #fff;
    margin-top: 60px; text-shadow: 0 0 30px rgba(0,232,123,0.15);
  }
  .logo span { color: #00e87b; text-shadow: 0 0 20px rgba(0,232,123,0.3); }
  .subtitle {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px; letter-spacing: 5px; color: #00e87b; opacity: 0.5;
    margin: 6px 0 48px;
  }

  .join-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 10px; letter-spacing: 4px; color: rgba(255,255,255,0.25); margin-bottom: 12px;
  }
  .code-input {
    background: rgba(255,255,255,0.03); backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 12px;
    color: #fff; font-family: 'Orbitron', sans-serif;
    font-size: 30px; font-weight: 900; letter-spacing: 12px;
    text-align: center; padding: 16px 24px; width: 260px;
    text-transform: uppercase; outline: none; transition: border-color 0.3s;
  }
  .code-input:focus { border-color: rgba(0,232,123,0.4); }
  .code-input::placeholder { color: rgba(255,255,255,0.1); letter-spacing: 12px; }

  .name-input {
    background: rgba(255,255,255,0.03); backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 10px;
    color: #fff; font-family: 'Rajdhani', sans-serif;
    font-size: 16px; text-align: center; padding: 12px 20px;
    width: 260px; outline: none; margin-top: 14px; transition: border-color 0.3s;
  }
  .name-input:focus { border-color: rgba(0,232,123,0.4); }
  .name-input::placeholder { color: rgba(255,255,255,0.15); }

  .join-btn {
    font-family: 'Orbitron', sans-serif;
    background: rgba(0,232,123,0.15); color: #00e87b;
    border: 1px solid rgba(0,232,123,0.3); border-radius: 12px;
    font-size: 14px; font-weight: 700; letter-spacing: 3px; padding: 16px 48px;
    margin-top: 24px; cursor: pointer; transition: all 0.3s;
  }
  .join-btn:hover { background: rgba(0,232,123,0.25); border-color: rgba(0,232,123,0.5); }
  .join-btn:disabled {
    background: rgba(255,255,255,0.02); color: rgba(255,255,255,0.15);
    border-color: rgba(255,255,255,0.05); cursor: not-allowed;
  }
  .error-msg { color: #ff6666; font-size: 13px; margin-top: 12px; min-height: 20px; }

  /* ── SCANNER SCREEN ── */
  .scanner-header {
    display: flex; align-items: center; justify-content: space-between;
    width: 100%; padding: 8px 0; margin-bottom: 16px;
  }
  .room-badge {
    font-family: 'Orbitron', sans-serif;
    background: rgba(0,232,123,0.08); border: 1px solid rgba(0,232,123,0.2);
    border-radius: 8px; padding: 6px 14px; font-size: 12px; font-weight: 700;
    letter-spacing: 4px; color: #00e87b;
    text-shadow: 0 0 10px rgba(0,232,123,0.3);
  }
  .player-name { font-size: 14px; color: rgba(255,255,255,0.3); }

  .camera-wrap {
    position: relative; width: 100%; max-width: 340px;
    aspect-ratio: 1; border-radius: 16px; overflow: hidden;
    border: 1px solid rgba(255,255,255,0.08); background: #000;
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
  }
  .camera-wrap video { width: 100%; height: 100%; object-fit: cover; }
  .camera-wrap canvas { display: none; }

  .scan-overlay {
    position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
    pointer-events: none;
  }
  .scan-reticle {
    width: 60%; height: 60%;
    border: 1px solid rgba(0,232,123,0.3); border-radius: 8px;
    position: relative;
    box-shadow: 0 0 20px rgba(0,232,123,0.05);
  }
  .scan-reticle::before, .scan-reticle::after {
    content: ''; position: absolute; background: rgba(0,232,123,0.6);
  }
  .scan-reticle::before { width: 20px; height: 1px; top: 50%; left: 50%; transform: translate(-50%,-50%); }
  .scan-reticle::after { width: 1px; height: 20px; top: 50%; left: 50%; transform: translate(-50%,-50%); }

  .scan-status {
    font-size: 13px; color: rgba(255,255,255,0.3); margin-top: 16px; letter-spacing: 1px;
    text-align: center; min-height: 20px;
  }
  .scan-status.success { color: #00e87b; text-shadow: 0 0 10px rgba(0,232,123,0.3); }

  .scanned-list { width: 100%; max-width: 340px; margin-top: 20px; }
  .scanned-list h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 10px; letter-spacing: 4px; color: rgba(255,255,255,0.25); margin-bottom: 10px;
  }
  .ship-card {
    display: flex; align-items: center; gap: 12px;
    background: rgba(255,255,255,0.025); backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.05); border-radius: 10px;
    padding: 10px 14px; margin-bottom: 8px;
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } }
  .ship-card-icon { width: 36px; height: 36px; flex-shrink: 0; }
  .ship-card-info { flex: 1; }
  .ship-card-name {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px; font-weight: 700; letter-spacing: 1px;
  }
  .ship-card-detail { font-size: 11px; color: rgba(255,255,255,0.3); letter-spacing: 1px; margin-top: 2px; }
  .ship-card-remove {
    background: none; border: none; color: rgba(255,68,68,0.4); font-size: 18px;
    cursor: pointer; padding: 4px 8px; transition: color 0.2s;
  }
  .ship-card-remove:hover { color: #ff4444; }

  /* ── MATCH SCREEN ── */
  .match-status {
    font-family: 'Orbitron', sans-serif;
    font-size: 18px; font-weight: 900; color: #00e87b; letter-spacing: 4px;
    margin-top: 80px; text-shadow: 0 0 30px rgba(0,232,123,0.3);
  }
  .match-msg { font-size: 14px; color: rgba(255,255,255,0.2); margin-top: 12px; }
  .pulse { animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
</style>
</head>
<body>

<div class="starfield" id="starfield"></div>

<!-- ═══ JOIN ═══ -->
<div class="screen active" id="joinScreen">
  <div class="logo">STAR<span>CHIP</span></div>
  <div class="subtitle">SCANNER</div>
  <div class="join-label">ENTER ROOM CODE</div>
  <input class="code-input" id="codeInput" type="text" maxlength="5" placeholder="····" autocomplete="off" autocorrect="off" spellcheck="false">
  <input class="name-input" id="nameInput" type="text" placeholder="Your name" maxlength="16" autocomplete="off">
  <button class="join-btn" id="joinBtn">JOIN ARENA</button>
  <div class="error-msg" id="errorMsg"></div>
</div>

<!-- ═══ SCANNER ═══ -->
<div class="screen" id="scanScreen">
  <div class="scanner-header">
    <div class="room-badge" id="roomBadge">----</div>
    <div class="player-name" id="playerNameDisplay"></div>
  </div>
  <div class="camera-wrap">
    <video id="video" autoplay playsinline></video>
    <canvas id="scanCanvas"></canvas>
    <div class="scan-overlay"><div class="scan-reticle"></div></div>
  </div>
  <div class="scan-status" id="scanStatus">Point camera at a StarChip QR code</div>
  <div class="scanned-list">
    <h3>YOUR FLEET (<span id="shipCount">0</span>)</h3>
    <div id="shipList"></div>
  </div>
</div>

<!-- ═══ MATCH ═══ -->
<div class="screen" id="matchScreen">
  <div class="logo">STAR<span>CHIP</span></div>
  <div class="match-status pulse">MATCH IN PROGRESS</div>
  <div class="match-msg">Watch the arena screen!</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script>
// ─── SHIP DATA ───
const PILOT_NAMES = ['RED','GREEN','BLUE','ORANGE','PINK','CYAN','LIME','CORAL','PURPLE','WHITE','YELLOW','MAGENTA','SKY','GOLD','SILVER','VIOLET'];
const PILOT_COLORS = ['#ff4444','#44ff88','#4488ff','#ffaa22','#dd66bb','#44ffff','#88dd55','#ff6b4a','#aa44ff','#ffffff','#ffff44','#ff00ff','#55bbff','#ffcc00','#bbbbcc','#8844dd'];
const SHIP_WEAPONS = ['alternating','chaotic','grenade','flamethrower','gatling','homing','snake','shotgun','scrap','basic','lightning','sniper','cyclone','drone','crossshot','concussive'];
const WEAPON_NAMES = {
  alternating:'Alternator', chaotic:'Chaotic Burst', grenade:'Grenade', flamethrower:'Flamethrower',
  gatling:'Gatling Gun', homing:'Homing Missiles', snake:'Snake Shot', shotgun:'Shotgun',
  scrap:'Scrap Cannon', basic:'Basic Blaster', lightning:'Lightning Bolt', sniper:'Sniper Beam',
  cyclone:'Cyclone Shot', drone:'Drone Array', crossshot:'Cross-Shot', concussive:'Scatterburst'
};
const SHIP_SHAPES = [
  [[-.1,-.15],[-.45,-.4],[-.2,-.4],[0,-.5],[-.2,-.65],[-.7,-.65],[-.7,-.4],[-.4,0],[-.75,.4],[-.75,.6],[-.5,.6],[-.2,.6],[0,.5],[-.2,.4],[-.45,.4],[-.1,.15],[.45,.2],[.6,.15],[.65,.1],[.75,.1],[.925,0],[.75,-.1],[.65,-.1],[.6,-.15],[.45,-.2]],
  [[-1,0],[-.7,-.1],[-.75,-.4],[-.4,-.85],[-.25,-.7],[-.3,-.15],[0,-.5],[.3,-.25],[.2,0],[.5,-.15],[1,0],[.2,.45],[-.15,.25],[-.25,.65],[-.4,.8],[-.7,.45],[-.7,.1]],
  [[1,0],[.75,-.2],[-.15,-1],[-.05,-.4],[-.35,-.25],[-.55,0],[-.35,.25],[-.05,.45],[-.15,1],[.75,.2]],
  [[1,0],[-.8,-.7],[-.65,-.2],[.1,0],[-.65,.2],[-.8,.7]],
  [[-.7,-.65],[-.5,-.75],[.15,-.55],[1,0],[.15,.55],[-.5,.75],[-.7,.65],[-.75,.35],[-.5,.1],[-.35,0],[-.5,-.1],[-.75,-.4]],
  [[-.15,-.65],[-.8,-.65],[-.4,0],[-.8,.65],[-.2,.6],[-.45,.4],[1,0],[-.45,-.45]],
  [[.7,-.55],[.3,-1],[-.75,-.7],[-.85,-.2],[-.5,0],[-.85,.25],[-.7,.75],[.4,.95],[.65,.55],[.25,.7],[-.35,.5],[.2,.3],[1.1,0],[.2,-.25],[-.35,-.55],[.2,-.7]],
  [[.55,-.25],[.1,-.65],[.1,-.2],[-.65,-.9],[-.45,-.1],[-1,0],[-.45,.15],[-.65,.9],[.1,.15],[.1,.6],[.55,.2],[.6,.5],[1,0],[.6,-.6]],
  [[-.75,-.8],[.1,-.5],[-.85,-.2],[.2,0],[-.85,.25],[.1,.55],[-.75,.8],[.1,.75],[.6,.3],[1,0],[.6,-.3],[.1,-.7]],
  [[1,0],[-.7,-.65],[-.4,0],[-.7,.65]],
  [[1.2,0],[-.4,-.55],[-.6,-.45],[-.7,-.65],[-.2,-.2],[-.2,-.1],[-.85,0],[-.25,.05],[-.25,.2],[-.55,.4],[-.45,.65],[-.7,.65],[0,.3],[.15,-.05],[.25,.2],[.55,-.05],[.75,.25],[.85,.05]],
  [[.95,0],[-.9,-.7],[-.5,0],[-.9,.65],[.05,.3],[-.4,-.3],[.3,.15],[.15,-.2],[.6,.1]],
  [[.25,-.15],[.5,-.25],[1,0],[.5,.25],[.25,.15],[0,.25],[.2,.45],[.35,.75],[.1,.95],[-.5,.95],[0,.7],[-.25,.6],[-.1,.5],[-.4,.25],[-.6,.25],[-1.05,.35],[-1,0],[-1.05,-.4],[-.6,-.25],[-.4,-.25],[-.25,-.35],[-.05,-.5],[-.25,-.6],[0,-.7],[-.5,-.95],[.1,-.95],[.35,-.75],[.2,-.45],[0,-.25]],
  [[.99,0],[-.5,.85],[-.69,.55],[-.5,.35],[-.79,.4],[-.99,0],[-.79,-.4],[-.45,-.3],[-.69,-.55],[-.5,-.84]],
  [[.85,-.5],[.75,-.65],[.5,-.85],[.25,-.95],[0,-1],[-.25,-.95],[-.5,-.85],[-.75,-.65],[-.85,-.5],[-1,0],[-.85,.5],[-.65,.75],[-.25,.95],[0,1],[.25,.95],[.55,.85],[.85,.55],[-.25,.65],[-.2,.25],[-.3,.1],[.25,0],[-.3,-.1],[-.2,-.25],[-.25,-.6]],
  [[.35,-.3],[.3,-.5],[-.25,-.95],[-.5,-.85],[-.1,-.3],[-.3,-.2],[-1,-.35],[-.8,-.1],[-.1,0],[-.1,0],[-.8,.1],[-1,.35],[-.3,.2],[-.1,.3],[-.5,.85],[-.25,.95],[.3,.5],[.35,.3],[.95,.2],[1.05,0],[.95,-.2]],
];

function drawShipPreview(canvas, designIdx, color) {
  const size = canvas.width, ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, size, size);
  const verts = SHIP_SHAPES[designIdx] || SHIP_SHAPES[9];
  const r = size * 0.35;
  ctx.save(); ctx.translate(size/2, size/2);
  ctx.shadowColor = color; ctx.shadowBlur = size * 0.15;
  ctx.strokeStyle = color; ctx.lineWidth = Math.max(1.5, size * 0.06);
  ctx.fillStyle = color + '33'; ctx.lineJoin = 'round';
  ctx.beginPath(); ctx.moveTo(verts[0][0]*r, verts[0][1]*r);
  for (let i = 1; i < verts.length; i++) ctx.lineTo(verts[i][0]*r, verts[i][1]*r);
  ctx.closePath(); ctx.fill(); ctx.stroke(); ctx.restore();
}

// ─── STATE ───
let ws = null, myId = null, myShips = [], scanCooldown = false;

// ─── DOM ───
const joinScreen = document.getElementById('joinScreen');
const scanScreen = document.getElementById('scanScreen');
const matchScreen = document.getElementById('matchScreen');
const codeInput = document.getElementById('codeInput');
const nameInput = document.getElementById('nameInput');
const joinBtn = document.getElementById('joinBtn');
const errorMsg = document.getElementById('errorMsg');
const roomBadge = document.getElementById('roomBadge');
const playerNameDisplay = document.getElementById('playerNameDisplay');
const scanStatus = document.getElementById('scanStatus');
const shipList = document.getElementById('shipList');
const shipCount = document.getElementById('shipCount');
const video = document.getElementById('video');
const scanCanvas = document.getElementById('scanCanvas');

function showScreen(s) {
  [joinScreen, scanScreen, matchScreen].forEach(x => x.classList.remove('active'));
  s.classList.add('active');
}

function getServerUrl() {
  const l = location; return `${l.protocol === 'https:' ? 'wss:' : 'ws:'}//${l.host}`;
}

// ─── JOIN ───
joinBtn.onclick = () => {
  const code = codeInput.value.trim().toUpperCase();
  const name = nameInput.value.trim() || 'Player';
  if (code.length < 3) { errorMsg.textContent = 'Enter a valid room code'; return; }
  errorMsg.textContent = 'Connecting...'; joinBtn.disabled = true;
  ws = new WebSocket(getServerUrl());
  ws.onopen = () => { ws.send(JSON.stringify({ type: 'join_room', code, name })); };
  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    switch (msg.type) {
      case 'joined':
        myId = msg.id; roomBadge.textContent = msg.code;
        playerNameDisplay.textContent = nameInput.value.trim() || 'Player';
        showScreen(scanScreen); startCamera(); break;
      case 'error':
        errorMsg.textContent = msg.message; joinBtn.disabled = false; break;
      case 'scan_confirmed':
        scanStatus.textContent = 'StarChip registered!'; scanStatus.className = 'scan-status success';
        setTimeout(() => { scanStatus.textContent = 'Scan another StarChip'; scanStatus.className = 'scan-status'; }, 1500); break;
      case 'match_started': showScreen(matchScreen); break;
      case 'match_ended': showScreen(scanScreen); break;
      case 'room_closed':
        errorMsg.textContent = 'Arena disconnected'; showScreen(joinScreen); joinBtn.disabled = false; break;
    }
  };
  ws.onerror = () => { errorMsg.textContent = 'Connection failed'; joinBtn.disabled = false; };
  ws.onclose = () => {
    if (scanScreen.classList.contains('active') || matchScreen.classList.contains('active')) {
      errorMsg.textContent = 'Disconnected from arena'; showScreen(joinScreen); joinBtn.disabled = false;
    }
  };
};
codeInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') joinBtn.click(); });

if ('serviceWorker' in navigator) navigator.serviceWorker.register('/sw.js').catch(() => {});

// ─── QR SCANNING ───
function startCamera() {
  navigator.mediaDevices.getUserMedia({
    video: { facingMode: 'environment', width: { ideal: 640 }, height: { ideal: 640 } }
  }).then(stream => { video.srcObject = stream; video.play(); requestAnimationFrame(scanFrame); })
    .catch(() => { scanStatus.textContent = 'Camera access denied'; });
}

function scanFrame() {
  if (!scanScreen.classList.contains('active')) return;
  if (video.readyState === video.HAVE_ENOUGH_DATA && !scanCooldown) {
    scanCanvas.width = video.videoWidth; scanCanvas.height = video.videoHeight;
    const ctx = scanCanvas.getContext('2d', { willReadFrequently: true });
    ctx.drawImage(video, 0, 0);
    const imageData = ctx.getImageData(0, 0, scanCanvas.width, scanCanvas.height);
    const code = jsQR(imageData.data, imageData.width, imageData.height, { inversionAttempts: 'dontInvert' });
    if (code && code.data) processQR(code.data);
  }
  requestAnimationFrame(scanFrame);
}

function parseQR(data) {
  const parts = data.split(':');
  if (parts[0] !== 'BBR' || parts.length < 6) return null;
  const d = parseInt(parts[1]), w = parseInt(parts[2]), c = parts[3];
  const p = parseInt(parts[4]), m = parseInt(parts[5]);
  const t = parts.length >= 7 ? parseInt(parts[6]) : d; // temperament defaults to design
  if (isNaN(d)||isNaN(w)||isNaN(p)||isNaN(m)||isNaN(t)) return null;
  if (d<0||d>15||w<0||w>15||p<0||p>15||m<0||m>15||t<0||t>15) return null;
  if (!/^[0-9a-fA-F]{6}$/.test(c)) return null;
  return { d, w, c: '#' + c, p, m, t };
}

function processQR(data) {
  const ship = parseQR(data); if (!ship) return;
  if (myShips.some(s => s._raw === data)) {
    scanStatus.textContent = 'Already scanned this StarChip'; scanStatus.className = 'scan-status';
    scanCooldown = true; setTimeout(() => { scanCooldown = false; }, 1500); return;
  }
  scanCooldown = true; setTimeout(() => { scanCooldown = false; }, 2000);
  ship._raw = data; myShips.push(ship); renderShipList();
  ws.send(JSON.stringify({ type: 'scan_ship', ship: { d: ship.d, w: ship.w, c: ship.c, p: ship.p, m: ship.m, t: ship.t } }));
  if (navigator.vibrate) navigator.vibrate(100);
}

function renderShipList() {
  shipCount.textContent = myShips.length; shipList.innerHTML = '';
  myShips.forEach((ship, i) => {
    const card = document.createElement('div'); card.className = 'ship-card';
    const canvas = document.createElement('canvas');
    canvas.width = 72; canvas.height = 72; canvas.className = 'ship-card-icon';
    drawShipPreview(canvas, ship.d, ship.c);
    const info = document.createElement('div'); info.className = 'ship-card-info';
    info.innerHTML = `<div class="ship-card-name" style="color:${ship.c}">${PILOT_NAMES[ship.d]}</div><div class="ship-card-detail">${WEAPON_NAMES[SHIP_WEAPONS[ship.w]] || 'Unknown'}</div>`;
    const removeBtn = document.createElement('button'); removeBtn.className = 'ship-card-remove'; removeBtn.textContent = '✕';
    removeBtn.onclick = () => { myShips.splice(i, 1); renderShipList(); ws.send(JSON.stringify({ type: 'remove_ship', index: i })); };
    card.appendChild(canvas); card.appendChild(info); card.appendChild(removeBtn);
    shipList.appendChild(card);
  });
}

// ─── STARFIELD ───
const sf = document.getElementById('starfield');
const H = Math.max(innerHeight, 900);
for(let i=0;i<120;i++){const s=document.createElement('div');s.className='star';const z=Math.random()<.9?.5+Math.random()*1.5:2+Math.random()*2,b=.1+Math.random()*.4,p=Math.min(b+.1+Math.random()*.4,1);s.style.cssText=`width:${z}px;height:${z}px;left:${Math.random()*100}%;top:${Math.random()*H}px;--base-o:${b};--peak-o:${p};opacity:${b};animation:twinkle ${3+Math.random()*6}s ease-in-out ${Math.random()*4}s infinite;${z>2?`box-shadow:0 0 ${z*2}px ${z*.5}px rgba(200,220,255,.15);`:''}`;sf.appendChild(s)}
const ac=['#3a3a4a','#2a2a38','#4a4a58','#333345'];
for(let i=0;i<8;i++){const a=document.createElement('div');a.className='asteroid';const sz=15+Math.random()*40;a.style.cssText=`width:${sz}px;height:${sz*(.5+Math.random()*.5)}px;left:${Math.random()*100}%;top:${Math.random()*H}px;--rot:${Math.random()*360}deg;--dx:${-15+Math.random()*30}px;--dy:${-8+Math.random()*16}px;background:${ac[Math.floor(Math.random()*ac.length)]};border-radius:${30+Math.random()*40}% ${30+Math.random()*40}% ${30+Math.random()*40}% ${30+Math.random()*40}%;animation:drift ${30+Math.random()*40}s ease-in-out ${Math.random()*10}s infinite alternate;`;sf.appendChild(a)}
</script>
</body>
</html>
